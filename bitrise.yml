---
format_version: '4'

# This config is invoked by a wrapper configuration stored in bitrise.io
# See https://devcenter.bitrise.io/tips-and-tricks/use-bitrise-yml-from-repository/
# and https://app.bitrise.io/app/d528939eac6fe1db#/workflow

workflows:
  ci:
    steps:
    - script:
      title: Pact Ruby
      inputs:
      - content: |-
        #!/usr/bin/env bash
        set -ex

        ruby -v
        bundle --version

        cd pact/ruby
        cd consumer
        bundle install
        bundle exec rspec
        cd -

        cd provider
        bundle install
        bundle exec rake pact:verify
    - script:
      title: Pact Java
      inputs:
      - content: |-
        #!/usr/bin/env bash
        set -ex

        cd pact/java/provider
        ./gradlew clean build
        java -jar build/libs/gs-actuator-service-0.1.0.jar &> /dev/null &
        sleep 20
        cd ../consumer
        ./gradlew test
        cd ../provider
        ./gradlew pactVerify
